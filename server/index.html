<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Test Client</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.1/socket.io.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .panel {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .log-container {
      flex-grow: 1;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 15px;
      overflow-y: auto;
      background-color: #f8f8f8;
      height: 300px;
    }
    h2 {
      margin-top: 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input, textarea, button {
      margin-bottom: 10px;
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .group-members {
      margin-top: 10px;
      border-top: 1px solid #ddd;
      padding-top: 10px;
    }
    .log-entry {
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 4px;
    }
    .log-info {
      background-color: #e1f5fe;
    }
    .log-error {
      background-color: #ffebee;
    }
    .log-success {
      background-color: #e8f5e9;
    }
    .log-message {
      background-color: #fff8e1;
    }
    .tab-container {
      border-bottom: 1px solid #ccc;
      margin-bottom: 15px;
    }
    .tab {
      display: inline-block;
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-bottom: none;
      border-radius: 4px 4px 0 0;
      margin-right: 5px;
      background-color: #f1f1f1;
    }
    .tab.active {
      background-color: white;
      border-bottom: 1px solid white;
      margin-bottom: -1px;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>WebSocket Test Client</h1>
    
    <div class="panel">
      <h2>Connect to WebSocket</h2>
      <label for="serverUrl">Server URL:</label>
      <input type="text" id="serverUrl" value="http://localhost:5000" />
      
      <label for="token">JWT Token:</label>
      <input type="text" id="token" placeholder="Paste your JWT token here" />
      
      <button id="connectBtn">Connect</button>
      <button id="disconnectBtn" disabled>Disconnect</button>
    </div>

    <div class="tab-container">
      <div class="tab active" data-tab="private">Private Messages</div>
      <div class="tab" data-tab="group">Group Management</div>
    </div>
    
    <div id="privateTab" class="tab-content active">
      <div class="panel">
        <h2>Send Private Message</h2>
        <label for="recipientId">Recipient User ID:</label>
        <input type="text" id="recipientId" placeholder="User ID to send message to" />
        
        <label for="privateMessage">Message:</label>
        <textarea id="privateMessage" rows="3" placeholder="Type your message here"></textarea>
        
        <button id="sendPrivateBtn" disabled>Send Private Message</button>
      </div>
    </div>
    
    <div id="groupTab" class="tab-content">
      <div class="panel">
        <h2>Group Management</h2>
        <label for="groupId">Group ID:</label>
        <input type="text" id="groupId" placeholder="Enter group ID" />
        
        <button id="joinGroupBtn" disabled>Join Group</button>
        <button id="leaveGroupBtn" disabled>Leave Group</button>
        
        <div class="group-members" id="groupMembers"></div>
      </div>
      
      <div class="panel">
        <h2>Send Group Message</h2>
        <label for="messageGroupId">Group ID:</label>
        <input type="text" id="messageGroupId" placeholder="Group ID to send message to" />
        
        <label for="groupMessage">Message:</label>
        <textarea id="groupMessage" rows="3" placeholder="Type your group message here"></textarea>
        
        <button id="sendGroupBtn" disabled>Send Group Message</button>
      </div>
    </div>
    
    <h2>Event Log</h2>
    <div class="log-container" id="log"></div>
  </div>

  <script>
    let socket;
    let userId;
    
    // DOM elements
    const connectBtn = document.getElementById('connectBtn');
    const disconnectBtn = document.getElementById('disconnectBtn');
    const sendPrivateBtn = document.getElementById('sendPrivateBtn');
    const joinGroupBtn = document.getElementById('joinGroupBtn');
    const leaveGroupBtn = document.getElementById('leaveGroupBtn');
    const sendGroupBtn = document.getElementById('sendGroupBtn');
    const log = document.getElementById('log');
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    // Tab switching
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
      });
    });
    
    // Connect to WebSocket
    connectBtn.addEventListener('click', () => {
      const serverUrl = document.getElementById('serverUrl').value.trim();
      const token = document.getElementById('token').value.trim();
      
      if (!token) {
        addLogEntry('Please enter a JWT token', 'error');
        return;
      }
      
      try {
        socket = io(serverUrl, {
          auth: { token },
          transports: ['websocket']
        });
        
        addLogEntry('Connecting to WebSocket...', 'info');
        
        // Socket events
        socket.on('connect', () => {
          addLogEntry('Connected to WebSocket server', 'success');
          updateButtonStates(true);
        });
        
        socket.on('disconnect', () => {
          addLogEntry('Disconnected from WebSocket server', 'info');
          updateButtonStates(false);
        });
        
        socket.on('connect_error', (error) => {
          addLogEntry(`Connection error: ${error.message}`, 'error');
          updateButtonStates(false);
        });
        
        socket.on('message', (data) => {
          if (data.type === 'auth_success') {
            userId = data.userId;
            addLogEntry(`Authentication successful! Your user ID: ${data.userId} (${data.name})`, 'success');
          } else if (data.type === 'private_message') {
            addLogEntry(`Private message from ${data.from.name}: ${data.content}`, 'message');
          } else if (data.type === 'group_message') {
            addLogEntry(`Group message in ${data.groupId} from ${data.from.name}: ${data.content}`, 'message');
          } else if (data.type === 'group_joined') {
            addLogEntry(`Joined group: ${data.groupId}`, 'success');
          } else if (data.type === 'group_left') {
            addLogEntry(`Left group: ${data.groupId}`, 'info');
          } else if (data.type === 'error') {
            addLogEntry(`Error: ${data.message}`, 'error');
          } else {
            addLogEntry(`Received: ${JSON.stringify(data)}`, 'info');
          }
        });
        
      } catch (error) {
        addLogEntry(`Error initializing socket: ${error.message}`, 'error');
      }
    });
    
    // Disconnect from WebSocket
    disconnectBtn.addEventListener('click', () => {
      if (socket) {
        socket.disconnect();
        addLogEntry('Manually disconnected from WebSocket server', 'info');
        updateButtonStates(false);
      }
    });
    
    // Send private message
    sendPrivateBtn.addEventListener('click', () => {
      const recipientId = document.getElementById('recipientId').value.trim();
      const content = document.getElementById('privateMessage').value.trim();
      
      if (!recipientId || !content) {
        addLogEntry('Please enter recipient ID and message content', 'error');
        return;
      }
      
      socket.emit('private_message', { to: recipientId, content });
      addLogEntry(`Private message sent to ${recipientId}: ${content}`, 'info');
    });
    
    // Join group
    joinGroupBtn.addEventListener('click', () => {
      const groupId = document.getElementById('groupId').value.trim();
      
      if (!groupId) {
        addLogEntry('Please enter a group ID', 'error');
        return;
      }
      
      socket.emit('join_group', groupId);
      document.getElementById('messageGroupId').value = groupId;
      addLogEntry(`Joining group: ${groupId}`, 'info');
    });
    
    // Leave group
    leaveGroupBtn.addEventListener('click', () => {
      const groupId = document.getElementById('groupId').value.trim();
      
      if (!groupId) {
        addLogEntry('Please enter a group ID', 'error');
        return;
      }
      
      socket.emit('leave_group', groupId);
      addLogEntry(`Leaving group: ${groupId}`, 'info');
    });
    
    // Send group message
    sendGroupBtn.addEventListener('click', () => {
      const groupId = document.getElementById('messageGroupId').value.trim();
      const content = document.getElementById('groupMessage').value.trim();
      
      if (!groupId || !content) {
        addLogEntry('Please enter group ID and message content', 'error');
        return;
      }
      
      socket.emit('group_message', { groupId, content });
      addLogEntry(`Group message sent to ${groupId}: ${content}`, 'info');
    });
    
    // Helper functions
    function updateButtonStates(connected) {
      connectBtn.disabled = connected;
      disconnectBtn.disabled = !connected;
      sendPrivateBtn.disabled = !connected;
      joinGroupBtn.disabled = !connected;
      leaveGroupBtn.disabled = !connected;
      sendGroupBtn.disabled = !connected;
    }
    
    function addLogEntry(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }
  </script>
</body>
</html>