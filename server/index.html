<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .panel {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
        }
        .message-container {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            background-color: #f9f9f9;
        }
        .message {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
        }
        .received {
            background-color: #e3f2fd;
        }
        .sent {
            background-color: #e8f5e9;
            text-align: right;
        }
        input, select, button, textarea {
            padding: 8px;
            margin: 5px 0;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .input-group {
            display: flex;
            margin-bottom: 10px;
        }
        .input-group input {
            flex-grow: 1;
            margin-right: 10px;
        }
        .status {
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
        }
        .connected {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .disconnected {
            background-color: #f2dede;
            color: #a94442;
        }
        textarea {
            width: 100%;
            height: 80px;
        }
    </style>
</head>
<body>
    <h1>WebSocket Test Client</h1>
    
    <div class="container">
        <div class="panel">
            <h2>Connection</h2>
            <div class="input-group">
                <input type="text" id="server-url" value="ws://localhost:5000" placeholder="WebSocket Server URL">
                <input type="text" id="auth-token" placeholder="JWT Token">
                <button id="connect-btn">Connect</button>
                <button id="disconnect-btn" disabled>Disconnect</button>
            </div>
            <div id="connection-status" class="status disconnected">Disconnected</div>
        </div>
        
        <div class="panel">
            <h2>Private Messaging</h2>
            <input type="text" id="recipient-id" placeholder="Recipient User ID">
            <textarea id="private-message" placeholder="Type private message..."></textarea>
            <button id="send-private-btn" disabled>Send Private Message</button>
            
            <h3>Messages</h3>
            <div id="private-messages" class="message-container"></div>
        </div>
        
        <div class="panel">
            <h2>Group Messaging</h2>
            <div class="input-group">
                <input type="text" id="group-id" placeholder="Group ID">
                <button id="join-group-btn" disabled>Join Group</button>
                <button id="leave-group-btn" disabled>Leave Group</button>
            </div>
            <textarea id="group-message" placeholder="Type group message..."></textarea>
            <button id="send-group-btn" disabled>Send Group Message</button>
            
            <h3>Group Messages</h3>
            <div id="group-messages" class="message-container"></div>
        </div>
    </div>

    <script>
        let socket = null;
        let currentUserId = null;
        let currentGroupId = null;
        
        // Connection elements
        const serverUrlInput = document.getElementById('server-url');
        const authTokenInput = document.getElementById('auth-token');
        const connectBtn = document.getElementById('connect-btn');
        const disconnectBtn = document.getElementById('disconnect-btn');
        const connectionStatus = document.getElementById('connection-status');
        
        // Private messaging elements
        const recipientIdInput = document.getElementById('recipient-id');
        const privateMessageInput = document.getElementById('private-message');
        const sendPrivateBtn = document.getElementById('send-private-btn');
        const privateMessagesContainer = document.getElementById('private-messages');
        
        // Group messaging elements
        const groupIdInput = document.getElementById('group-id');
        const joinGroupBtn = document.getElementById('join-group-btn');
        const leaveGroupBtn = document.getElementById('leave-group-btn');
        const groupMessageInput = document.getElementById('group-message');
        const sendGroupBtn = document.getElementById('send-group-btn');
        const groupMessagesContainer = document.getElementById('group-messages');
        
        // Connect to WebSocket server
        connectBtn.addEventListener('click', () => {
            const serverUrl = serverUrlInput.value;
            const token = authTokenInput.value;
            
            try {
                socket = new WebSocket(serverUrl);
                
                // Connection opened
                socket.addEventListener('open', (event) => {
                    // Send authentication
                    socket.send(JSON.stringify({
                        type: 'authenticate',
                        token: token
                    }));
                    
                    // Update UI
                    connectionStatus.textContent = 'Connected';
                    connectionStatus.className = 'status connected';
                    connectBtn.disabled = true;
                    disconnectBtn.disabled = false;
                    sendPrivateBtn.disabled = false;
                    joinGroupBtn.disabled = false;
                    leaveGroupBtn.disabled = false;
                });
                
                // Listen for messages
                socket.addEventListener('message', (event) => {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'auth_success') {
                        // Authentication successful
                        currentUserId = data.userId;
                        addMessage(privateMessagesContainer, `Authenticated as User ID: ${currentUserId}`, 'received');
                    } else if (data.type === 'private_message') {
                        // Received private message
                        addMessage(
                            privateMessagesContainer, 
                            `From ${data.from.name}: ${data.content}`, 
                            'received'
                        );
                    } else if (data.type === 'group_message') {
                        // Received group message
                        addMessage(
                            groupMessagesContainer, 
                            `[Group: ${data.groupId}] ${data.from.name}: ${data.content}`, 
                            'received'
                        );
                    } else if (data.type === 'error') {
                        // Error message
                        alert(`Error: ${data.message}`);
                    }
                });
                
                // Connection closed
                socket.addEventListener('close', (event) => {
                    connectionStatus.textContent = 'Disconnected';
                    connectionStatus.className = 'status disconnected';
                    resetButtons();
                });
                
                // Connection error
                socket.addEventListener('error', (event) => {
                    connectionStatus.textContent = 'Connection Error';
                    connectionStatus.className = 'status disconnected';
                    resetButtons();
                    console.error('WebSocket error:', event);
                });
                
            } catch (error) {
                alert('Connection failed: ' + error.message);
                console.error('Connection error:', error);
            }
        });
        
        // Disconnect from server
        disconnectBtn.addEventListener('click', () => {
            if (socket) {
                socket.close();
                socket = null;
            }
        });
        
        // Send private message
        sendPrivateBtn.addEventListener('click', () => {
            const recipientId = recipientIdInput.value;
            const message = privateMessageInput.value;
            
            if (!recipientId || !message) {
                alert('Please enter recipient ID and message');
                return;
            }
            
            socket.send(JSON.stringify({
                type: 'private_message',
                to: recipientId,
                content: message
            }));
            
            // Add sent message to UI
            addMessage(privateMessagesContainer, `To ${recipientId}: ${message}`, 'sent');
            
            // Clear input
            privateMessageInput.value = '';
        });
        
        // Join group
        joinGroupBtn.addEventListener('click', () => {
            const groupId = groupIdInput.value;
            
            if (!groupId) {
                alert('Please enter group ID');
                return;
            }
            
            socket.send(JSON.stringify({
                type: 'join_group',
                groupId: groupId
            }));
            
            currentGroupId = groupId;
            sendGroupBtn.disabled = false;
            addMessage(groupMessagesContainer, `Joined group: ${groupId}`, 'received');
        });
        
        // Leave group
        leaveGroupBtn.addEventListener('click', () => {
            const groupId = groupIdInput.value;
            
            if (!groupId) {
                alert('Please enter group ID');
                return;
            }
            
            socket.send(JSON.stringify({
                type: 'leave_group',
                groupId: groupId
            }));
            
            if (currentGroupId === groupId) {
                currentGroupId = null;
                sendGroupBtn.disabled = true;
            }
            
            addMessage(groupMessagesContainer, `Left group: ${groupId}`, 'received');
        });
        
        // Send group message
        sendGroupBtn.addEventListener('click', () => {
            const groupId = groupIdInput.value;
            const message = groupMessageInput.value;
            
            if (!groupId || !message) {
                alert('Please enter group ID and message');
                return;
            }
            
            socket.send(JSON.stringify({
                type: 'group_message',
                groupId: groupId,
                content: message
            }));
            
            // Add sent message to UI
            addMessage(groupMessagesContainer, `[Group: ${groupId}] You: ${message}`, 'sent');
            
            // Clear input
            groupMessageInput.value = '';
        });
        
        // Helper function to add message to container
        function addMessage(container, text, type) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${type}`;
            messageElement.textContent = text;
            container.appendChild(messageElement);
            container.scrollTop = container.scrollHeight;
        }
        
        // Reset buttons to initial state
        function resetButtons() {
            connectBtn.disabled = false;
            disconnectBtn.disabled = true;
            sendPrivateBtn.disabled = true;
            joinGroupBtn.disabled = true;
            leaveGroupBtn.disabled = true;
            sendGroupBtn.disabled = true;
        }
    </script>
</body>
</html>